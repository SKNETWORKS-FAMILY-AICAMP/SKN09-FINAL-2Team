CREATE USER 'user123'@'%' IDENTIFIED BY 'user123';

CREATE DATABASE `senpick_db` CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;
GRANT ALL PRIVILEGES ON `senpick_db`.* TO 'user123'@'%';
FLUSH PRIVILEGES;


USE senpick_db;

DROP TABLE IF EXISTS `USER`;
CREATE TABLE `USER` (
  `USER_ID` CHAR(32) NOT NULL,
  `EMAIL` VARCHAR(255) NOT NULL UNIQUE,    
  `PASSWORD` VARCHAR(255) NOT NULL,                  
  `NICKNAME` VARCHAR(30) NOT NULL,                     
  `BIRTH` CHAR(8) NOT NULL,                              
  `GENDER` VARCHAR(8) NOT NULL,    
  `JOB` VARCHAR(50),   
  `PROFILE_IMAGE` VARCHAR(255) DEFAULT NULL,   
  `TYPE` VARCHAR(10) NOT NULL DEFAULT 'guest',   
  `SOCIAL_PROVIDER` VARCHAR(10) DEFAULT NULL,         
  `IS_EMAIL_VERIFIED` BOOLEAN NOT NULL DEFAULT FALSE,   
  `CREATED_AT` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `UPDATED_AT` DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`USER_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

DROP TABLE IF EXISTS `CHAT`;
CREATE TABLE `CHAT` (
  `CHAT_ID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `USER_ID` CHAR(32) NOT NULL,
  `TITLE` VARCHAR(100) NOT NULL,
  `CREATED_AT` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `IS_DELETED` BOOLEAN NOT NULL DEFAULT FALSE,
  PRIMARY KEY (`CHAT_ID`),
  CONSTRAINT `FK_CHAT_USER_ID` FOREIGN KEY (`USER_ID`) REFERENCES `USER` (`USER_ID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

DROP TABLE IF EXISTS `CHAT_MSG`;
CREATE TABLE `CHAT_MSG` (
  `MSG_ID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `CHAT_ID` INT UNSIGNED NOT NULL,
  `SENDER` VARCHAR(20) NOT NULL,
  `MESSAGE` TEXT NOT NULL,
  `CREATED_AT` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`MSG_ID`),
  CONSTRAINT `FK_CHAT_MESSAGE_CHAT_ID` FOREIGN KEY (`CHAT_ID`) REFERENCES `CHAT` (`CHAT_ID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

DROP TABLE IF EXISTS `RECIPIENT`;
CREATE TABLE `RECIPIENT` (
  `CHAT_ID` INT UNSIGNED NOT NULL,
  `GENDER` CHAR(8) NOT NULL,
  `AGE_GROUP` VARCHAR(20) NOT NULL,
  `RELATION` VARCHAR(20) DEFAULT NULL,
  `ANNIVERSARY` VARCHAR(50) DEFAULT NULL,
  `SITUATION_INFO` TEXT DEFAULT NULL,
  `CREATED_AT` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`CHAT_ID`),
  CONSTRAINT `FK_RECIPIENT_INFO_CHAT_ID` FOREIGN KEY (`CHAT_ID`) REFERENCES `CHAT` (`CHAT_ID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

DROP TABLE IF EXISTS `CHAT_RCMD`;
CREATE TABLE `CHAT_RCMD` (
  `RCMD_ID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `MESSAGE_ID` INT UNSIGNED NOT NULL,
  `PRODUCT_ID` INT UNSIGNED NOT NULL,
  `IS_LIKED` BOOLEAN NOT NULL DEFAULT FALSE,
  `CREATED_AT` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`RCMD_ID`),
  CONSTRAINT `FK_RCMD_MESSAGE_ID` FOREIGN KEY (`MESSAGE_ID`) REFERENCES `CHAT_MSG` (`MSG_ID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_RCMD_PRODUCT_ID` FOREIGN KEY (`PRODUCT_ID`) REFERENCES `PRODUCT` (`PRODUCT_ID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


DROP TABLE IF EXISTS `PREFER_TYPE`;
CREATE TABLE `PREFER_TYPE` (
  `PREFER_ID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `TYPE` VARCHAR(20) NOT NULL,           
  `TYPE_NAME` VARCHAR(100) NOT NULL,     
  PRIMARY KEY (`PREFER_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


DROP TABLE IF EXISTS `USER_PREFER`;
CREATE TABLE `USER_PREFER` (
  `USER_ID` CHAR(32) NOT NULL,
  `PREFER_ID` INT UNSIGNED NOT NULL,
  `CREATED_AT` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `UPDATED_AT` DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  CONSTRAINT `FK_USER_PREF_USER` FOREIGN KEY (`USER_ID`) REFERENCES `USER` (`USER_ID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_USER_PREF_TYPE` FOREIGN KEY (`PREFER_ID`) REFERENCES `PREFER_TYPE` (`PREFER_ID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 선호 스타일
INSERT INTO PREFER_TYPE (`TYPE`, `TYPE_NAME`) VALUES
('스타일', '감성적'),
('스타일', '실용적'),
('스타일', '트렌디'),
('스타일', '미니멀'),
('스타일', '럭셔리'),
('스타일', '유니크'),
('스타일', '자연친화'),
('스타일', '클래식');

-- 선호 카테고리
INSERT INTO PREFER_TYPE (`TYPE`, `TYPE_NAME`) VALUES
('카테고리', '식품'),
('카테고리', '뷰티'),
('카테고리', '패션'),
('카테고리', '반려동물'),
('카테고리', '교환권'),
('카테고리', '건강·케어'),
('카테고리', '아기·어린이'),
('카테고리', '레저·자동차'),
('카테고리', '디지털·가전'),
('카테고리', '프리미엄 선물'),
('카테고리', '리빙·인테리어');