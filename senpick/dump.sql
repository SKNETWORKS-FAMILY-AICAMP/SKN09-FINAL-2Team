CREATE USER user123@'%' IDENTIFIED BY 'user123';

CREATE DATABASE `senpick_db` CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;
GRANT ALL PRIVILEGES ON `senpick_db`.* TO 'user123'@'%';
FLUSH PRIVILEGES;

USE senpick_db;

DROP TABLE IF EXISTS `USER`;
CREATE TABLE `USER` (
  `USER_ID` int unsigned NOT NULL AUTO_INCREMENT,
  `EMAIL` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `PASSWORD` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `NICKNAME` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `BIRTH` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `GENDER` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `JOB` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `PROFILE_IMAGE` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `TYPE` int unsigned DEFAULT NULL,
  `SOCIAL_PROVIDER` int unsigned DEFAULT NULL,
  `IS_EMAIL_VERIFIED` int unsigned DEFAULT NULL,
  `CREATED_AT` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `UPDATED_AT` int unsigned DEFAULT NULL,
  PRIMARY KEY (`USER_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=35643 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;



DROP TABLE IF EXISTS `CHAT`;
CREATE TABLE `CHAT` (
  `CHAT_ID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `USER_ID` BINARY(16) NOT NULL,
  `TITLE` VARCHAR(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  `CREATED_AT` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `IS_DELETED` BOOLEAN NOT NULL DEFAULT FALSE,
  PRIMARY KEY (`CHAT_ID`),
  CONSTRAINT `FK_CHAT_USER_ID` FOREIGN KEY (`USER_ID`) REFERENCES `USER` (`USER_ID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

DROP TABLE IF EXISTS `CHAT_MSG`;
CREATE TABLE `CHAT_MSG` (
  `MSG_ID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `CHAT_ID` INT UNSIGNED NOT NULL,
  `SENDER` VARCHAR(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  `MESSAGE` TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  `CREATED_AT` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`MSG_ID`),
  CONSTRAINT `FK_CHAT_MESSAGE_CHAT_ID` FOREIGN KEY (`CHAT_ID`) REFERENCES `CHAT` (`CHAT_ID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


DROP TABLE IF EXISTS `RECIPIENT`;
CREATE TABLE `RECIPIENT` (
  `CHAT_ID` INT UNSIGNED NOT NULL,
  `GENDER` CHAR(8) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  `AGE_GROUP` VARCHAR(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  `RELATION` VARCHAR(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `ANNIVERSARY` VARCHAR(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `SITUATION_INFO` TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `CREATED_AT` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`CHAT_ID`),
  CONSTRAINT `FK_RECIPIENT_INFO_CHAT_ID` FOREIGN KEY (`CHAT_ID`) REFERENCES `CHAT` (`CHAT_ID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

DROP TABLE IF EXISTS `CHAT_RCMD`;
CREATE TABLE `CHAT_RCMD` (
  `RCMD_ID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `MESSAGE_ID` INT UNSIGNED NOT NULL,
  `PRODUCT_ID` INT UNSIGNED NOT NULL,
  `IS_LIKED` BOOLEAN NOT NULL DEFAULT FALSE,
  `CREATED_AT` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`RCMD_ID`),
  CONSTRAINT `FK_RCMD_MESSAGE_ID` FOREIGN KEY (`MESSAGE_ID`) REFERENCES `CHAT_MESSAGE` (`MSG_ID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `FK_RCMD_PRODUCT_ID` FOREIGN KEY (`PRODUCT_ID`) REFERENCES `PRODUCT` (`PRODUCT_ID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
